<html>
<head>
<title>Get Mouse Coordinates</title>
<script src="/socket.io/socket.io.js"></script>
<script>

  //var socket = io.connect('http://amaze.nodester.com'); // http://localhost when running locally
  var socket = io.connect('http://localhost'); //  http://maze.nodester.com')


  //var name = prompt('What is your nickname?', 'Write your name');
  var connected = false;
  var mazeWriter = false;
  var inGame = false;

  socket.on('connect', function () {

    socket.on('ready', function() {
    	console.log("Please be patient; you'll be able to play as soon as an opponent arrives and joins your game!");
    });

    socket.on('startGameMAzeWriter', function() {
    	clearCanvas();
    	inGame = true;
    	mazeWriter = true; // set the second player to join a game to be the maze writer, not the maze traverser
    	console.log("GET YOUR MAZE ON!  start playing jock jams");
    });

    socket.on('startGamePathFinder', function() {
    	console.log("Let the games begin, good luck finding your way out... PathFinder!");
    	clearCanvas();
    	inGame = true;
    	mouseDown = false;
    	mazeWriter = false;
    	document.getElementById("block1").style.
		old_xy = [];
    });

    socket.on('otherPlayerDisconnect',function(log) {
    	inGame = false;
	});

    socket.on('drawLine',function(coord) {
    	 drawLine(coord.x1,coord.y1,coord.x2,coord.y2, 'red');
    	//drawPoint(coord.x2,coord.y2,'red');
    });

    socket.on('drawMazeLine',function(line) {
    	 drawLine(line.x1,line.y1,line.x2,line.y2, 'black');
    });

    socket.on('drawPathLine',function(line) {
    	 drawLine(line.x1,line.y1,line.x2,line.y2, 'green');
    });

    socket.on('consoleLog',function(log) {
		console.log(log);
	});

  });



</script>
<script language="javascript">



</script>


</head>

<body style="background-color:navy;">
	<div id="mouseCoord" style="background-color:white;">Mouse Coordinates position will be displayed here.</div>
	<div id="old_xy" style="background-color:white;">old xy displayed here.</div>
	<button onclick="setMode('drag') ">Input Drag</button>
	<button onclick="setMode('line') ">Input Line</button>
	<br/>
	<div id="canvas-container" style="position:relative; width:600px; height:600px;" >
		<canvas id="can" width="600" height="600" style="background-color:white;"></canvas>
		<div id="block1" style="height:0px; width:600px; background:black; z-index:999999; position:absolute; 
								top:0px; left:0px;

								-moz-box-shadow:    3px 0px 5px 6px #000;
  								-webkit-box-shadow: 3px 0px 5px 6px #000;
  								box-shadow:         3px 0px 5px 6px #000;

								"> </div>
		<div id="block2" style="height:600px; width:0px; background:black; z-index:999999; position:absolute; 
								top:0px; right:0px;

								-moz-box-shadow:    0px 3px 5px 6px #000;
  								-webkit-box-shadow: 0px 3px 5px 6px #000;
  								box-shadow:         0px 3px 5px 6px #000;

								"> </div>
		<div id="block3" style="height:0px; width:600px; background:black; z-index:999999; position:absolute; 
								bottom:0px; right:0px;

								-moz-box-shadow:    -3px 0px 5px 6px #000;
  								-webkit-box-shadow: -3px 0px 5px 6px #000;
  								box-shadow:         -3px 0px 5px 6px #000;

								"> </div>
		<div id="block4" style="height:600px; width:0px; background:black; z-index:999999; position:absolute; 
								bottom:0px; left:0px;

								-moz-box-shadow:    0px -3px 5px 6px #000;
  								-webkit-box-shadow: 0px -3px 5px 6px #000;
  								box-shadow:         0px -3px 5px 6px #000;

								"> </div>
	</div>
\<script type="text/javascript">
//Canvas Code: BEGIN
{

	var canWidth = 600;
	var canHeight = canWidth;
	var slitWidth = 20;
	var slitHeight = slitWidth;

	function clipper(point){
		var obj=document.getElementById("block1");
		obj.style.height=point.y - slitHeight;

		var obj=document.getElementById("block2");
		obj.style.width=(canWidth - point.x) - slitWidth;

		var obj=document.getElementById("block3");
		obj.style.height=(canHeight - point.y) - slitHeight;

		var obj=document.getElementById("block4");
		obj.style.width= point.x - slitWidth;

	}

	// hide canvase http://robertnyman.com/2011/07/26/using-the-html5-canvas-clip-method-to-hide-certain-content/
	var canvas = document.getElementById('can');
	var clipPoint;
	function drawLine(x1,y1,x2,y2,color){
		if(canvas.getContext){
			var ctx = canvas.getContext('2d');
			ctx.strokeStyle=color;
			ctx.beginPath();
			ctx.moveTo(x1,y1);
			ctx.lineTo(x2,y2);
			ctx.stroke();
		}
	}

	function drawPoint(x,y,color){
		if(canvas.getContext){
			var ctx = canvas.getContext('2d');
			ctx.strokeStyle=color;
			ctx.beginPath();
			dot(ctx,x,y,3,color);
			ctx.stroke();
		}
	}

	function dot(ctx,x,y,rad,color){
		ctx.arc(x,y,rad,0,2*Math.PI,false);
		ctx.fillStyle=color;
		ctx.fill();
	}

	function clearCanvas(){
		if(canvas.getContext){
			var ctx = canvas.getContext('2d');
			ctx.clearRect(0, 0, canvas.width, canvas.height);
		}
	}

}
//Canvas Code: END

//Mouse Events and Sending Lines: BEGIN
{
	var isMouseDown = false;
	var inputMode = mazeWriter? 'line' : 'drag'; //'drag'||'line'
	var firstPoint = {};

	document.onmousedown=mouseDown;
	document.onmouseup=mouseUp;
	document.onmousemove=mouseMove;

	function mouseDown() {
		//console.log('mousedown!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!');
		firstPoint = getPoint();
		isMouseDown = true;
	}
	function mouseMove(){
		if(inputMode != 'line'){
			if(!mazeWriter || isMouseDown){
				sendLine();	
			}
			//console.log(firstPoint);
			if(isMouseDown){
				firstPoint = getPoint();//this cannot happen before sendLine is called!
			}
		}

		if(!mazeWriter && inGame){
			clipper(getPoint());
		}

	}
	function mouseUp() {
		if(mazeWriter) { //nothing should ever change on mouseup for mazeSolver
			//console.log('I am the mazeWriter firstPoint = ',firstPoint);
			//alert("emitting endLIne");
			//socket.emit('endLine', {name:name}); // this may be superfluous if always in line mode for mazeWriter...
			//if(inputMode == 'line'){
				sendLine('end');
			//}
			firstPoint = {};//this cannot happen before sendLine() is called!
			console.log(' firstPoint = ',firstPoint);
			isMouseDown = false;

		}
	}

	function setMode(mode) {
		if(mazeWriter){
			inputMode = mode;
			alert('input mode has been set to'+ mode);
		}
		else{
			alert('you are not the mazeWriter, No cheating! ')
		}
	}

	function getPoint() {
			ev = window.event;
			document.getElementById("mouseCoord").innerHTML = "Mouse X:"+ev.pageX + " Mouse Y:"+ev.pageY;
			document.getElementById("old_xy").innerHTML = "Old_xy"+old_xy; 

			// offset calculation needs to change once there are other elements on the page
			// see quirksmode.org/js/findpos.html for details
			var canvas = document.getElementById('can');
			var x = ev.pageX - canvas.offsetLeft;
			var y = ev.pageY - canvas.offsetTop;
			return {x:x, y:y};
	}

	function sendLine(end){
		if(inGame){
			var secondPoint = getPoint();
			socket.emit('sendLine',{x1:firstPoint.x, y1:firstPoint.y, x2: secondPoint.x, y2:secondPoint.y, n:name, end:end});
			//console.log({x1:firstPoint.x, y1:firstPoint.y, x2: secondPoint.x, y2:secondPoint.y, n:name, end:end});
			drawLine(firstPoint.x,firstPoint.y,secondPoint.x,secondPoint.y,'purple'); // this should be commented out for now it lets you see the path that the mouse takes when out of bounds.
		}
	}
}
//Mouse Events and Sending Lines: END

</script>
</body>
</html>